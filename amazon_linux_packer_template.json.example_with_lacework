{
  "variables": {
      "aws_region": "{{env `AWS_REGION`}}",
      "aws_ami_name": "amazon_linux_packer_{{isotime \"20060102150405\"}}",
      "lw_account": "{{env `LW_ACCOUNT`}}",
      "lw_api_key": "{{env `LW_API_KEY`}}",
      "lw_api_secret": "{{env `LW_API_SECRET`}}"
  },

  "builders": [{
      "type": "amazon-ebs",
      "region": "{{user `aws_region`}}",
      "instance_type": "t2.micro",
      "ssh_username": "ec2-user",
      "ami_name": "{{user `aws_ami_name`}}",
      "ami_description": "Customized Amazon Linux - Generated by Packer",
      "associate_public_ip_address": "true",
      "source_ami_filter": {
          "filters": {
              "virtualization-type": "hvm",
              "name": "amzn-ami*-ebs",
              "root-device-type": "ebs"
          },
          "owners": ["137112412989", "591542846629", "801119661308", "102837901569", "013907871322", "206029621532", "286198878708", "443319210888"],
          "most_recent": true
      }
  }],

  "provisioners": [
    {
        "type": "file",
        "source": "files/lacework-cli.sh",
        "destination": "/tmp/lacework-cli.sh"
    },
    {
        "type": "shell",
        "environment_vars": [
            "LW_ACCOUNT={{user `lw_account`}}",
            "LW_API_KEY={{user `lw_api_key`}}",
            "LW_API_SECRET={{user `lw_api_secret`}}"
        ],
        "inline": [
            "sudo yum update -y",
            "source /tmp/lacework-cli.sh",
            "rm /tmp/lacework-cli.sh",
            "echo \"Removing Lacework CLI from base image...\"",
            "sudo rm -rf /usr/local/bin/lacework"
        ]
    }
  ]
}